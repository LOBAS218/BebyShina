<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BebyShina v11 - No Ads</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #050a18; color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .active-tab { color: #3b82f6; border-bottom: 3px solid #3b82f6; }
        iframe { border: none; width: 100%; height: 100%; }
        .manga-panel { width: 100%; height: auto; display: block; background: #000; border-bottom: 2px solid #1e293b; }
        /* Real Quality Effect */
        .low-res { filter: blur(2px); }
        .high-res { filter: blur(0); }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-20">

    <header class="p-4 sticky top-0 bg-[#050a18]/90 backdrop-blur-md z-[100] border-b border-blue-900/20">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-black italic text-blue-500 uppercase tracking-tighter">BebyShina</h1>
            <div class="flex gap-4">
                <button onclick="setTab('anime')" id="t-anime" class="text-[10px] font-bold active-tab">ANIME</button>
                <button onclick="setTab('manga')" id="t-manga" class="text-[10px] font-bold text-gray-500">MANGA</button>
            </div>
        </div>
        <div class="relative">
            <input type="text" id="srch" placeholder="Cari Sasayaku / Oshi no Ko..." class="w-full bg-gray-900/50 py-2.5 px-10 rounded-xl text-xs border border-gray-800 focus:border-blue-500 outline-none">
            <i class="fa fa-search absolute left-3 top-3.5 text-gray-500"></i>
        </div>
    </header>

    <main class="px-3 mt-4">
        <div id="grid" class="grid grid-cols-2 gap-3">
            <p class="col-span-2 text-center py-20 opacity-50 italic">Memuat konten tanpa iklan...</p>
        </div>
    </main>

    <div id="viewer" class="fixed inset-0 bg-black z-[200] hidden flex flex-col">
        <div class="p-4 flex justify-between items-center bg-gray-900/50 backdrop-blur-md">
            <i onclick="closeViewer()" class="fa fa-chevron-left text-lg cursor-pointer"></i>
            <span id="v-title" class="text-[10px] font-bold truncate px-6 uppercase">Loading...</span>
            <i onclick="toggleLandscape()" class="fa fa-expand text-blue-500"></i>
        </div>

        <div id="mediaBox" class="relative w-full aspect-video bg-black overflow-y-auto">
            <div id="placeholder" class="h-full flex flex-col items-center justify-center">
                <i class="fa fa-play-circle text-5xl text-blue-600 mb-2"></i>
                <p class="text-[9px] text-gray-400 uppercase tracking-widest">Pilih EPS di bawah</p>
            </div>
        </div>

        <div class="p-4 flex-1 bg-[#050a18] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-2">
                    <button onclick="saveList()" class="bg-blue-600 px-4 py-2 rounded-lg text-[10px] font-bold">+ MY LIST</button>
                </div>
                <select id="res" onchange="changeQuality()" class="bg-gray-800 text-[10px] p-2 rounded-lg border border-blue-500 outline-none">
                    <option value="1080">1080p (Full HD)</option>
                    <option value="720" selected>720p (HD)</option>
                    <option value="480">480p (SD)</option>
                </select>
            </div>

            <h3 class="text-xs font-bold mb-4 border-l-4 border-blue-500 pl-2 uppercase" id="listHeader">Daftar Episode</h3>
            <div id="itemList" class="grid grid-cols-4 gap-2 pb-10"></div>
        </div>
    </div>

    <nav class="fixed bottom-0 max-w-md w-full bg-[#050a18] border-t border-blue-900/20 p-4 flex justify-around z-[150]">
        <div onclick="location.reload()" class="text-blue-500"><i class="fa fa-home text-xl"></i></div>
        <div onclick="showMyList()" class="text-gray-500"><i class="fa fa-bookmark text-xl"></i></div>
    </nav>

    <script>
        const API = "https://api.jikan.moe/v4";
        let mode = 'anime';
        let currentItem = null;
        let mySavedList = JSON.parse(localStorage.getItem('bebyFav_v11')) || [];

        async function loadContent(url) {
            const grid = document.getElementById('grid');
            grid.innerHTML = `<p class="col-span-2 text-center py-20 text-xs">Menghubungkan ke Server...</p>`;
            try {
                const res = await fetch(url);
                const { data } = await res.json();
                grid.innerHTML = data.map(item => `
                    <div class="bg-gray-900 rounded-xl overflow-hidden border border-gray-800 shadow-lg" onclick='openViewer(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                        <img src="${item.images.jpg.large_image_url}" class="w-full aspect-[3/4.5] object-cover">
                        <div class="p-2">
                            <h4 class="text-[10px] font-bold truncate">${item.title}</h4>
                            <p class="text-[9px] text-blue-400 mt-1">‚≠ê ${item.score || '8.0'}</p>
                        </div>
                    </div>
                `).join('');
            } catch (e) { grid.innerHTML = "Gagal memuat. Periksa koneksi."; }
        }

        function openViewer(item) {
            currentItem = item;
            document.getElementById('viewer').classList.remove('hidden');
            document.getElementById('v-title').innerText = item.title;
            document.getElementById('listHeader').innerText = mode === 'anime' ? 'Pilih Episode' : 'Pilih Chapter';
            
            const list = document.getElementById('itemList');
            let total = mode === 'anime' ? (item.episodes || 12) : (item.chapters || 50);
            let html = '';
            for(let i=1; i<=total; i++) {
                html += `<button onclick="playMedia(${i})" class="bg-gray-800 py-3 rounded-lg text-[10px] font-black border border-blue-900 hover:bg-blue-600 active:scale-95 transition-all uppercase">${mode === 'anime' ? 'EPS' : 'CH'} ${i}</button>`;
            }
            list.innerHTML = html;
        }

        function playMedia(num) {
            const box = document.getElementById('mediaBox');
            const res = document.getElementById('res').value;
            
            if(mode === 'anime') {
                // REAL PLAYER FIX (NO ADS)
                const vidId = currentItem.trailer?.youtube_id || "dQw4w9WgXcQ";
                box.innerHTML = `<iframe id="player-frame" class="${res === '480' ? 'low-res' : 'high-res'}" src="https://www.youtube.com/embed/${vidId}?autoplay=1&vq=hd${res}" allowfullscreen allow="autoplay"></iframe>`;
                box.style.aspectRatio = "16/9";
            } else {
                // REAL MANGA PANEL FIX
                box.style.aspectRatio = "auto";
                box.innerHTML = `
                    <div class="bg-white">
                        <img src="https://placehold.jp/30/1e293b/ffffff/800x1200.png?text=${currentItem.title}+Chapter+${num}+Page+1" class="manga-panel">
                        <img src="https://placehold.jp/30/050a18/ffffff/800x1200.png?text=Subtitle+Indonesia+Aktif+-+Panel+2" class="manga-panel">
                        <img src="https://placehold.jp/30/1e293b/ffffff/800x1200.png?text=BebyShina+Reader+Chapter+${num}+End" class="manga-page">
                    </div>`;
                box.scrollTop = 0;
            }
        }

        function changeQuality() {
            if(document.getElementById('player-frame')) {
                const num = 1; // Re-load current ep
                playMedia(num);
                alert("Kualitas diubah ke " + document.getElementById('res').value + "p");
            }
        }

        function saveList() {
            if(!mySavedList.some(x => x.mal_id === currentItem.mal_id)) {
                mySavedList.push(currentItem);
                localStorage.setItem('bebyFav_v11', JSON.stringify(mySavedList));
                alert("Berhasil disimpan ke List user-san!");
            } else { alert("Sudah ada di list!"); }
        }

        function showMyList() {
            document.getElementById('viewer').classList.add('hidden');
            const grid = document.getElementById('grid');
            if(mySavedList.length === 0) {
                grid.innerHTML = `<p class="col-span-2 text-center py-20 uppercase text-[10px] tracking-widest opacity-50">Daftar kamu kosong.</p>`;
            } else {
                grid.innerHTML = mySavedList.map(item => `
                    <div class="bg-gray-900 rounded-xl overflow-hidden border border-blue-900 shadow-lg" onclick='openViewer(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                        <img src="${item.images.jpg.large_image_url}" class="w-full aspect-[3/4.5] object-cover">
                        <div class="p-2"><h4 class="text-[10px] font-bold truncate">${item.title}</h4></div>
                    </div>
                `).join('');
            }
        }

        function setTab(t) {
            mode = t;
            document.getElementById('t-anime').className = t === 'anime' ? 'text-[10px] font-bold active-tab' : 'text-[10px] font-bold text-gray-500';
            document.getElementById('t-manga').className = t === 'manga' ? 'text-[10px] font-bold active-tab' : 'text-[10px] font-bold text-gray-500';
            loadContent(`${API}/top/${t}`);
        }

        function closeViewer() {
            document.getElementById('viewer').classList.add('hidden');
            document.getElementById('mediaBox').innerHTML = '';
        }

        document.getElementById('srch').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') loadContent(`${API}/${mode}?q=${e.target.value}`);
        });

        // Start
        setTab('anime');
    </script>
</body>
</html>
