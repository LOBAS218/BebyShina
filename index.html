<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BebyShina - Cinema Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #020617; color: white; font-family: 'sans-serif'; overflow-x: hidden; }
        .active-tab { color: #3b82f6; border-bottom: 3px solid #3b82f6; }
        .genre-btn.active { background: #3b82f6; border-color: #60a5fa; }
        
        /* Player Styles */
        #mainVideo { width: 100%; height: 100%; background: black; }
        .landscape-mode { 
            position: fixed !important; top: 0; left: 0; width: 100vw !important; height: 100vh !important; 
            z-index: 999; transform: rotate(0deg); background: black;
        }
        .rotated { transform: rotate(90deg); width: 100vh !important; height: 100vw !important; top: 50%; left: 50%; translate: -50% -50%; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-24">

    <header class="p-4 sticky top-0 bg-[#020617] z-[50] border-b border-blue-900/30">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-black italic text-blue-500 uppercase">BebyShina</h1>
            <div class="flex gap-3 text-[10px] font-bold">
                <button onclick="setMode('anime')" id="t-anime" class="active-tab">ANIME</button>
                <button onclick="setMode('manga')" id="t-manga" class="text-gray-500">MANGA</button>
            </div>
        </div>
        <input type="text" id="srch" placeholder="Cari Anime/Manga..." class="w-full bg-gray-900 p-2 rounded-lg text-xs outline-none border border-gray-800 focus:border-blue-500">
    </header>

    <div id="genreBox" class="p-3 flex gap-2 overflow-x-auto no-scrollbar"></div>

    <main class="px-3">
        <h2 id="sectionLabel" class="text-xs font-bold mb-3 text-blue-400">ðŸ”¥ REKOMENDASI TERBARU</h2>
        <div id="contentGrid" class="grid grid-cols-2 gap-3"></div>
    </main>

    <div id="playerView" class="fixed inset-0 bg-black z-[100] hidden flex flex-col">
        <div class="p-4 flex justify-between items-center bg-gradient-to-b from-black to-transparent absolute top-0 w-full z-10">
            <i onclick="closePlayer()" class="fa fa-chevron-left text-xl"></i>
            <span id="videoTitle" class="text-xs font-bold truncate px-4">Loading...</span>
            <i onclick="toggleRotation()" class="fa fa-sync-alt text-lg text-blue-400"></i>
        </div>

        <div id="videoWrapper" class="relative w-full aspect-video bg-black flex items-center justify-center">
            <video id="mainVideo" controls crossorigin="anonymous">
                <source id="videoSource" src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
                Subtitles not supported.
            </video>
            
            <div class="absolute bottom-12 right-2 flex gap-2">
                <select onchange="changeQuality(this.value)" class="bg-black/70 text-[10px] p-1 rounded border border-blue-500">
                    <option value="1080">1080p</option>
                    <option value="720" selected>720p</option>
                    <option value="360">360p</option>
                </select>
                <select class="bg-black/70 text-[10px] p-1 rounded border border-blue-500">
                    <option>Indo (Auto)</option>
                    <option>English</option>
                </select>
            </div>
        </div>

        <div class="p-4 flex-1 overflow-y-auto bg-[#020617]">
            <div class="flex justify-between items-center mb-4">
                <button onclick="saveToList()" class="bg-blue-600 px-6 py-2 rounded-full text-xs font-bold w-full mr-2">+ TAMBAHKAN KE LIST</button>
            </div>
            <h3 class="text-sm font-bold mb-3 uppercase border-l-4 border-blue-500 pl-2">Pilih Episode</h3>
            <div id="epsList" class="grid grid-cols-4 gap-2"></div>
        </div>
    </div>

    <nav class="fixed bottom-0 max-w-md w-full bg-[#020617] border-t border-blue-900/40 p-4 flex justify-around">
        <div onclick="location.reload()" class="text-blue-500 text-center"><i class="fa fa-home"></i><br><span class="text-[9px]">Home</span></div>
        <div onclick="showMyList()" class="text-gray-400 text-center"><i class="fa fa-bookmark"></i><br><span class="text-[9px]">My List</span></div>
    </nav>

    <script>
        const API = "https://api.jikan.moe/v4";
        let mode = 'anime';
        let currentItem = null;
        let isRotated = false;

        const genres = [
            {id: 1, name: "Action"}, {id: 22, name: "Romance"}, 
            {id: 28, name: "Yaoi"}, {id: 26, name: "Yuri"}, {id: 10, name: "Fantasy"}
        ];

        // Init Genre
        function renderGenres() {
            document.getElementById('genreBox').innerHTML = genres.map(g => `
                <button onclick="fetchByGenre(${g.id})" class="genre-btn px-4 py-1.5 rounded-full border border-gray-800 bg-gray-900 text-[10px] whitespace-nowrap">
                    ${g.name}
                </button>
            `).join('');
        }

        async function loadContent(url) {
            const grid = document.getElementById('contentGrid');
            grid.innerHTML = `<p class="col-span-2 text-center py-10">Searching...</p>`;
            try {
                const res = await fetch(url);
                const { data } = await res.json();
                grid.innerHTML = data.map(item => `
                    <div class="bg-gray-900 rounded overflow-hidden shadow-lg border border-gray-800" onclick='openVideo(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                        <img src="${item.images.jpg.large_image_url}" class="w-full aspect-[3/4.5] object-cover">
                        <div class="p-2">
                            <h4 class="text-[10px] font-bold truncate uppercase">${item.title}</h4>
                            <p class="text-[8px] text-blue-400">Score: ${item.score || '8.0'}</p>
                        </div>
                    </div>
                `).join('');
            } catch (e) { grid.innerHTML = "Gagal mengambil data."; }
        }

        function openVideo(item) {
            currentItem = item;
            document.getElementById('playerView').classList.remove('hidden');
            document.getElementById('videoTitle').innerText = item.title;
            const video = document.getElementById('mainVideo');
            video.play(); // Auto play saat dibuka

            let epsHtml = '';
            let total = item.episodes || 12;
            for(let i=1; i<=total; i++) {
                epsHtml += `<button onclick="changeEps(${i})" class="bg-gray-800 py-3 rounded text-[10px] border border-blue-900">EP ${i}</button>`;
            }
            document.getElementById('epsList').innerHTML = epsHtml;
        }

        function changeEps(n) {
            alert("Memutar Episode " + n);
            const video = document.getElementById('mainVideo');
            video.currentTime = 0;
            video.play();
        }

        function changeQuality(res) {
            const video = document.getElementById('mainVideo');
            const time = video.currentTime;
            alert("Kualitas diubah ke " + res + "p");
            // Simulasi ganti source
            document.getElementById('videoSource').src = "https://www.w3schools.com/html/mov_bbb.mp4?res=" + res;
            video.load();
            video.currentTime = time;
            video.play();
        }

        function toggleRotation() {
            const wrapper = document.getElementById('videoWrapper');
            if(!isRotated) {
                wrapper.classList.add('landscape-mode', 'rotated');
                isRotated = true;
            } else {
                wrapper.classList.remove('landscape-mode', 'rotated');
                isRotated = false;
            }
        }

        function saveToList() {
            let list = JSON.parse(localStorage.getItem('bebyFav')) || [];
            if(!list.find(x => x.mal_id === currentItem.mal_id)) {
                list.push(currentItem);
                localStorage.setItem('bebyFav', JSON.stringify(list));
                alert("Berhasil masuk My List user-san!");
            }
        }

        function showMyList() {
            const data = JSON.parse(localStorage.getItem('bebyFav')) || [];
            document.getElementById('sectionLabel').innerText = "DAFTAR FAVORIT SAYA";
            document.getElementById('contentGrid').innerHTML = data.map(item => `
                 <div class="bg-gray-900 rounded overflow-hidden border border-blue-900" onclick='openVideo(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                    <img src="${item.images.jpg.large_image_url}" class="w-full aspect-[3/4.5] object-cover">
                    <div class="p-2"><h4 class="text-[10px] font-bold truncate">${item.title}</h4></div>
                </div>
            `).join('');
        }

        function setMode(m) {
            mode = m;
            document.getElementById('t-anime').className = m === 'anime' ? 'active-tab' : 'text-gray-500';
            document.getElementById('t-manga').className = m === 'manga' ? 'active-tab' : 'text-gray-500';
            loadContent(`${API}/top/${m}`);
        }

        function fetchByGenre(id) {
            loadContent(`${API}/${mode}?genres=${id}`);
        }

        function closePlayer() {
            const video = document.getElementById('mainVideo');
            video.pause();
            document.getElementById('playerView').classList.add('hidden');
        }

        // Search engine
        document.getElementById('srch').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') loadContent(`${API}/${mode}?q=${e.target.value}`);
        });

        // Start
        renderGenres();
        loadContent(`${API}/top/anime`);
    </script>
</body>
</html>
